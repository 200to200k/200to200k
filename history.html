<script>
    // Configuration initiale du graphique
    const ctx = document.getElementById('bankroll-chart').getContext('2d');
    const bankrollData = {
        labels: [], // Les dates seront ajoutées dynamiquement
        datasets: [{
            label: 'Évolution de la bankroll (€)',
            data: [], // Les valeurs de la bankroll seront ajoutées dynamiquement
            borderColor: '#f3a712',
            backgroundColor: 'rgba(243, 167, 18, 0.2)',
            borderWidth: 2,
            fill: true
        }]
    };

    const bankrollChart = new Chart(ctx, {
        type: 'line',
        data: bankrollData,
        options: {
            responsive: true,
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Date'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Montant (€)'
                    },
                    min: -100,
                    max: 1000
                }
            }
        }
    });

    // Gestion de l'ajout des paris et mise à jour du graphique
    const betForm = document.getElementById('bet-form');
    const historyTable = document.getElementById('history-table').getElementsByTagName('tbody')[0];

    betForm.addEventListener('submit', function(event) {
        event.preventDefault();

        // Récupérer les valeurs du formulaire
        const date = document.getElementById('date').value;
        const sport = document.getElementById('sport').value;
        const bet = document.getElementById('bet').value;
        const stake = parseFloat(document.getElementById('stake').value);
        const bankroll = parseFloat(document.getElementById('bankroll').value);
        const odds = parseFloat(document.getElementById('odds').value);
        const result = document.getElementById('result').value;

        // Calculer le gain ou la perte
        const gain = result === 'win' ? (stake * (odds - 1)).toFixed(2) : (-stake).toFixed(2);
        const newBankroll = (bankroll + parseFloat(gain)).toFixed(2);

        // Ajouter une nouvelle ligne au tableau
        const newRow = historyTable.insertRow();
        newRow.innerHTML = `
            <td>${date}</td>
            <td>${bet}</td>
            <td>${sport}</td>
            <td>${stake.toFixed(2)}</td>
            <td>${((stake / bankroll) * 100).toFixed(2)}%</td>
            <td>${odds}</td>
            <td>${gain}</td>
            <td>${result === 'win' ? 'Gagné' : 'Perdu'}</td>
        `;

        // Mettre à jour le graphique
        bankrollData.labels.push(date);
        bankrollData.datasets[0].data.push(newBankroll);
        bankrollChart.update();

        // Réinitialiser le formulaire
        betForm.reset();
    });
</script>
